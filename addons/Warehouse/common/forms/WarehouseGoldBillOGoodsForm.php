<?php

namespace addons\Warehouse\common\forms;

use Yii;
use addons\Warehouse\common\models\WarehouseGoldBillGoods;
use common\helpers\ArrayHelper;

/**
 * 单据明细 Form
 *
 */
class WarehouseGoldBillOGoodsForm extends WarehouseGoldBillGoods
{
    /**
     * {@inheritdoc}
     */
    public function rules()
    {
         $rules = [
             [['out_type','channel_id','gold_weight'], 'required'],
             [['gold_sn'],'unique'],
             ['gold_weight','compare','compareValue' => 0, 'operator' => '>'],
             //[['gold_sn','bill_type'],'unique','targetAttribute' => ['gold_sn', 'bill_type'],'comboNotUnique'=>'已被存在'],
             //[['gold_sn'],'unique', 'targetClass' => 'addons\Warehouse\common\models\WarehouseGold', 'message' => '库存已经存在.']
         ];
         return ArrayHelper::merge(parent::rules() , $rules);
    }

    /**
     * {@inheritdoc}
     */
    public function attributeLabels()
    {
        //合并
        return ArrayHelper::merge(parent::attributeLabels() , [
            'gold_sn' => '金料编号/批次号',
            'gold_weight' => '出库金重(g)',
        ]);
    }

    public function beforeSave($insert)
    {
        $gold_price = $this->gold_price ?? 0;
        $gold_weight = $this->gold_weight ?? 0;
        $this->cost_price = $gold_price * $gold_weight;
        if(empty($this->incl_tax_price) || $this->incl_tax_price <= 0) $this->incl_tax_price = $this->cost_price ;

        return parent::beforeSave($insert); // TODO: Change the autogenerated stub
    }


}
